<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.5991d603939a6d188be342b278a4555db90f163903158c623d2c39fde3d82cb3.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">w1redch4d - Lexical Analysis</title>
<meta property="og:title" content=w1redch4d&#32;-&#32;Lexical&#32;Analysis />
<meta name="twitter:title" content=w1redch4d&#32;-&#32;Lexical&#32;Analysis />
<meta itemprop="name" content=w1redch4d&#32;-&#32;Lexical&#32;Analysis />
<meta name="application-name" content=w1redch4d&#32;-&#32;Lexical&#32;Analysis />
<meta property="og:site_name" content="BloggerCh4d" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://w1redch4d.github.io/post/lexical-analysis/" />
<link rel="canonical" href="https://w1redch4d.github.io/post/lexical-analysis/" itemprop="url" />
<meta name="url" content="https://w1redch4d.github.io/post/lexical-analysis/" />
<meta name="twitter:url" content="https://w1redch4d.github.io/post/lexical-analysis/" />
<meta property="og:url" content="https://w1redch4d.github.io/post/lexical-analysis/" />


<meta property="og:updated_time" content="2025-04-13T08:44:23&#43;05:30" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://w1redch4d.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



  
    <meta name="twitter:site" content="@w1rech4d" />
    <meta name="twitter:creator" content="@w1rech4d" />

<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="BloggerCh4d" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.142.0">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.6513307315781f29e4509b23a7c150cb384b56fde67b79a46b81eaf6b1b60c1b.css">


    
    <style>
    body {
        --sidebar-bg-color: #1A1B2F;
        --sidebar-img-border-color: #3D3A74;
        --sidebar-p-color: #A0AEC0;
        --sidebar-h1-color: #F0F9FF;
        --sidebar-a-color: #C3F3FF;
        --sidebar-socials-color: #9BE8FF;
        --text-color: #2B2D42;
        --bkg-color: #F9FBFD;
        --post-title-color: #1F2937;
        --list-color: #4C566A;
        --link-color: #00B8D9;
        --date-color: #6D9DC5;
        --table-border-color: #CCEFFF;
        --table-stripe-color: #E6F7FB;
        --code-color: #1B1F23;
        --code-background-color: #D0F0FF;
        --code-block-color: #151515;
        --code-block-background-color: #F0F9FF;
        --moon-sun-color: #8AFFEF;
        --moon-sun-background-color: #2D2A55;
    }
    body.dark-theme {
        --text-color: #CBD5E1;
        --bkg-color: #0D1117;
        --post-title-color: #E0F7FA;
        --list-color: #B0BEC5;
        --link-color: #56CCF2;
        --date-color: #6B8CA4;
        --table-border-color: #3A506B;
        --table-stripe-color: #16202A;
        --code-color: #D6F6FF;
        --code-background-color: #2F3E46;
        --code-block-color: #F0F9FF;
        --code-block-background-color: #1E2A38;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://w1redch4d.github.io/">
                <img src="https://w1redch4d.github.io/images/avatar.jpeg" alt="brand image">
            </a>
        
        
            <a href="https://w1redch4d.github.io/">
                <h1>w1redch4d</h1>
            </a>
        
    </h1>
    <p class="lead">
    Fuzzing my brain till it gets SIGSEGV
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
            
                
                
            
            
                
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
            
                
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/w1redch4d">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>





    <a target="_blank" class="social" title="X" href="https://x.com/w1rech4d">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.1em" height="1.1em" viewBox="0 0 512 472.799">
            <path fill="currentColor" d="M403.229 0h78.506L310.219 196.04 512 462.799H354.002L230.261 301.007 88.669 462.799h-78.56l183.455-209.683L0 0h161.999l111.856 147.88L403.229 0zm-27.556 415.805h43.505L138.363 44.527h-46.68l283.99 371.278z"/>
        </svg>
    </a>

















        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 BloggerCh4d. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://w1redch4d.github.io/post/lexical-analysis/">Lexical Analysis</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2025-04-13T08:44:23&#43;0530" class="post-date">
        April 13, 2025
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>9 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-v8">
        <a href="https://w1redch4d.github.io/tags/v8">v8</a>
      </li>
      
      <li class="tag-compiler design">
        <a href="https://w1redch4d.github.io/tags/compiler-design">compiler design</a>
      </li>
      
      <li class="tag-lexical analysis">
        <a href="https://w1redch4d.github.io/tags/lexical-analysis">lexical analysis</a>
      </li>
      
      <li class="tag-scanner">
        <a href="https://w1redch4d.github.io/tags/scanner">scanner</a>
      </li>
      
      <li class="tag-token generation">
        <a href="https://w1redch4d.github.io/tags/token-generation">token generation</a>
      </li>
      
    </ul>
    
  </div>

  
  
  <p class="seriesname">
    Series: <a href="https://w1redch4d.github.io/series/understanding-v8-internals">Understanding V8 internals</a>
  </p>
  

  
</div>

  <h1 id="introduction-to-lexical-analysis">Introduction to Lexical Analysis</h1>
<p>Lexical analysis, also known as scanning or tokenization, is the first phase of a compiler. It is responsible for reading the source code as a stream of characters and converting it into a stream of tokens. These tokens are the basic building blocks for the subsequent phases of the compiler, such as parsing and semantic analysis.</p>
<h2 id="role-of-lexical-analysis">Role of Lexical Analysis</h2>
<p>The primary role of the lexical analyzer (lexer) is to break down the raw source code into meaningful units called <strong>tokens</strong>. These tokens represent elements like keywords, identifiers, operators, constants, and punctuation marks. By doing so, the lexer simplifies the input for the parser, which expects a sequence of tokens rather than a stream of individual characters.</p>
<p>Consider this example javascript code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">z</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">a</span> <span class="o">=</span> <span class="nx">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>To a computer this js source code, is just a stream of characters, separated by newlines, tabs and spaces, in this example lets assume that in computer&rsquo;s perspective the above source code will look as the following:</p>
<pre tabindex="0"><code>let&lt;space&gt;x,&lt;space&gt;z&lt;space&gt;=&lt;space&gt;0;\nlet&lt;space&gt;y,&lt;space&gt;a&lt;space&gt;=&lt;space&gt;1;\nif&lt;space&gt;(x&lt;space&gt;&gt;&lt;space&gt;y)&lt;space&gt;{\n\tz&lt;space&gt;=&lt;space&gt;1\n}&lt;space&gt;else&lt;space&gt;{\n\ta&lt;space&gt;=&lt;space&gt;z;\n}
</code></pre><p>where <code>&quot;\n&quot;</code> represents a newline, <code>&quot;\t&quot;</code> represents a tab and <code>&lt;space&gt;</code> represents the spaces which are there in the middle, the job for the interpreter is to now convert this stream of characters into a set of tokens. Now lets understand what do i mean by &ldquo;a stream of tokens&rdquo; in here, so basically we want to insert delimiters (<code>|</code>) into that stream of characters such that they distinguish one &ldquo;character&rdquo; from another :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="o">|</span> <span class="nx">x</span> <span class="o">|</span> <span class="p">,</span> <span class="o">|</span> <span class="nx">z</span> <span class="o">|</span> <span class="o">=</span> <span class="o">|</span> <span class="mi">0</span> <span class="o">|</span> <span class="p">;</span> <span class="kd">let</span> <span class="o">|</span> <span class="nx">y</span> <span class="o">|</span> <span class="p">,</span> <span class="o">|</span> <span class="nx">a</span> <span class="o">|</span> <span class="o">=</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">|</span> <span class="p">;</span> <span class="k">if</span> <span class="o">|</span> <span class="p">(</span> <span class="o">|</span> <span class="nx">x</span> <span class="o">|</span> <span class="o">&gt;</span> <span class="o">|</span> <span class="nx">y</span> <span class="o">|</span> <span class="p">)</span> <span class="o">|</span> <span class="p">{</span> <span class="o">|</span> <span class="nx">z</span> <span class="o">|</span> <span class="o">=</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">|</span> <span class="p">;</span> <span class="o">|</span> <span class="p">}</span> <span class="o">|</span> <span class="k">else</span> <span class="o">|</span> <span class="p">{</span> <span class="o">|</span> <span class="nx">a</span> <span class="o">|</span> <span class="o">=</span> <span class="o">|</span> <span class="nx">z</span> <span class="o">|</span> <span class="p">;</span> <span class="o">|</span> <span class="p">}</span>
</span></span></code></pre></div><p>so in this case the <code>if</code> word is one token (keyword token), and <code>x</code> is another token (identifier token), <code>\n</code> and <code>\t</code> or <code>&lt;space&gt;</code> for that matter are also tokens (whitespace tokens).</p>
<p>In the context of the V8 JavaScript engine, the <strong>Lexer</strong> is the first component in the JavaScript execution pipeline. It takes the JavaScript code and divides it into tokens such as keywords, constants, operators, and variables.</p>


<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    const lsTheme = localStorage.getItem("theme")
    const hugoTheme = document.body.classList.contains("dark-theme") ? "dark" : null
    const currTheme = lsTheme ? lsTheme : hugoTheme;
    const mermaidTheme = currTheme == "light" ? "default" : "dark"

    mermaid.initialize({theme: mermaidTheme});
</script>



<div class="mermaid">
graph TD
    A[Source Code] --> B(Lexer);
    B --> C[Token Stream];

</div>

<p>The <strong>&ldquo;Lexer&rdquo;</strong> for V8 is called <strong>&ldquo;scanner&rdquo;</strong> and can be found found in the directory <a href="https://v8-docs.vercel.app/dir_3fb67633942bd84f7aa391e58ba835b3.html" target="_blank"><code>./src/parsing</code></a> and the code that converts the stream of characters into token can be found here in the file <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00351" target="_blank"><code>scanner-inl.h</code></a> along with <a href="https://v8-docs.vercel.app/classv8_1_1internal_1_1Scanner.html#a11ad4829073aee72344151129608643b" target="_blank">call graph for the function</a>.</p>
<p><strong>Important Note:</strong> I am not using the official v8 source from the main refs as it is subject to change with newer commits in the future.</p>
<h2 id="tokens-lexemes-and-token-classes">Tokens, Lexemes, and Token Classes</h2>
<ul>
<li><strong>Token Class</strong>: A token class (or token type) is a category of tokens that share a common set of properties. Examples include <code>kIdentifier</code>, <code>KEYWORD</code>, <code>INTEGER_LITERAL</code>, <code>OPERATOR</code>, etc..</li>
<li><strong>Lexeme</strong>: A lexeme is the actual sequence of characters in the source code that matches the pattern for a token class. For example, <code>if</code> is a lexeme that belongs to the <code>KEYWORD</code> token class, and <code>count</code> is a lexeme that might belong to the <code>kIdentifier</code> token class.</li>
<li><strong>Token</strong>: A token is a pair consisting of a token class and its corresponding lexeme (or sometimes additional attributes like the value of a literal). For example, the lexeme <code>42</code> would result in a token like <code>&lt;INTEGER_LITERAL, &quot;42&quot;&gt;</code>.</li>
</ul>
<h2 id="token-class">Token Class</h2>
<p>A Token Class corresponds to a set of strings:</p>
<ul>
<li><strong>Identifier</strong>: string of letters or digits starting with a letter.</li>
<li><strong>Integer</strong>: string of digits.</li>
<li><strong>Keyword</strong>: <code>if</code>,<code>else</code>,<code>let</code>,<code>for</code>,<code>while</code>&hellip;</li>
<li><strong>Whitespaces</strong>: sequence of spaces, newlines, tabs, etc.</li>
</ul>
<p>The <strong>Token class</strong> source code for v8 can be found in the file <a href="https://v8-docs.vercel.app/token_8h_source.html#l00211" target="_blank"><code>token.h</code></a> along with the <a href="https://v8-docs.vercel.app/classv8_1_1internal_1_1Token.html" target="_blank"><code>Token Class Reference</code></a>.</p>
<h2 id="error-handling-in-lexical-analysis">Error Handling in Lexical Analysis</h2>
<p>When the lexer encounters a sequence of characters that does not match any of the defined token class patterns, a lexical error occurs. A common approach to handle lexical errors is to define a special <a href="https://v8-docs.vercel.app/token_8h_source.html#l00204" target="_blank"><strong>error token value</strong></a>. When no other pattern matches, the lexer can match the erroneous sequence (often just a single character) as an error token and <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00375" target="_blank">continue the scanning process</a>. This allows the compiler to detect multiple errors in a single pass. Error tokens can contain the problematic lexeme and potentially an error message.</p>
<h2 id="software-implementation-of-lexical-analyzers">Software Implementation of Lexical Analyzers</h2>
<p>Lexical analyzers can be implemented in several ways. Two common approaches involve using finite automata:</p>
<ul>
<li>
<p><strong>Deterministic Finite Automaton (DFA)</strong>: A DFA can be directly implemented using a <strong>transition table</strong>. The rows of the table represent the states of the DFA, and the columns represent the input characters. Each entry in the table specifies the next state for a given state and input character. Executing a DFA involves starting at the initial state and following the transitions based on the input characters until the end of the input is reached. The final state indicates whether a valid token has been recognized. DFAs provide efficient linear-time scanning but can sometimes result in larger state machines compared to NFAs.</p>
</li>
<li>
<p><strong>Non-deterministic Finite Automaton (NFA)</strong>: Regular expressions can be easily converted into NFAs. An NFA can have multiple possible next states for a given state and input character, as well as epsilon transitions (transitions without consuming any input). Simulating an NFA involves keeping track of the set of all possible states the automaton can be in at each step. While NFAs are often more compact than DFAs, their simulation can be slightly less efficient. However, tools can automatically convert regular expressions to NFAs and then to optimized DFAs for efficient lexical analysis.</p>
</li>
</ul>
<p>Many lexical analyzer generators (like Lex or Flex) take a specification of token classes in the form of regular expressions and automatically generate efficient C code for a lexer based on DFA implementation. In case of V8 as well the lexical analyzer a.k.a <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00351" target="_blank"><code>scanner</code></a> uses the DFA implementation on the <a href="https://v8-docs.vercel.app/token_8h_source.html#l00211" target="_blank"><code>token.h</code></a> file.</p>
<h2 id="lexer-in-v8">Lexer in V8</h2>
<p>In the V8 JavaScript engine, the <strong>Lexer</strong> is a crucial first step in processing JavaScript code. It takes the raw JavaScript source code and performs the following tasks:</p>
<ul>
<li>Scans the input character by character.</li>
<li>Identifies sequences of characters that form lexemes.</li>
<li>Categorizes these lexemes into predefined token classes (e.g., keywords like <code>function</code>, identifiers like variable names, operators like <code>+</code>, literals like <code>&quot;hello&quot;</code> or <code>123</code>).</li>
<li>Produces a stream of tokens that is then passed to the <strong>Parser</strong>.</li>
</ul>
<p>The V8 Lexer plays a vital role in the overall performance of the engine by efficiently breaking down the source code into a format that can be readily processed by subsequent stages of the compilation and execution pipeline.</p>
<p>Lets uncover how the lexer in v8 works with a testcase example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">is_greater</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="mi">1337</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="s2">&#34;GREATER!!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">is_greater</span><span class="p">(</span><span class="mi">13337</span><span class="p">));</span>
</span></span></code></pre></div><blockquote>
<p>Note: The test case is very simple, so it can’t cover the full flow of the scanner.</p>
</blockquote>
<p>The function <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00351" target="_blank"><code>Scanner::ScanSingleToken()</code></a> serves as the entry point for scanning individual tokens within the V8 engine. At this stage, the <code>c0_</code> variable is already initialized to point to the first character of the js source code stream. In the provided test scenario, <code>c0_</code> references the character <code>'f'</code>. Let us examine the workflow in detail. Early in the function, specifically by the <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00360" target="_blank">fifth line of code</a>, there is a check to determine if <code>c0_</code> contains a character within the ASCII range. Given that <code>c0_</code> holds <code>'f'</code>, this condition evaluates to true. Following this, the <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00361" target="_blank">sixth line</a> references the <a href="https://v8-docs.vercel.app/scanner-inl_8h_source.html#l00180" target="_blank"><code>one_char_tokens</code></a> data structure — a predefined template in V8 consisting of an array of character types. This structure is segmented into several logical components, which classify characters accordingly. In this case, <code>'f'</code> is recognized as an ASCII identifier via the <a href="https://v8-docs.vercel.app/char-predicates-inl_8h_source.html#l00026" target="_blank"><code>IsAsciiIdentifier(c)</code></a> method, categorizing it under the <a href="https://v8-docs.vercel.app/token_8h_source.html#l00178" target="_blank"><code>Token::kIdentifier</code></a> type. Within the <code>ScanSingleToken()</code> function, given that <code>c0_</code> is classified as <code>Token::kIdentifier</code>, the scanner delegates further processing to the <a href="https://v8-docs.vercel.app/char-predicates-inl_8h_source.html#l000188" target="_blank"><code>ScanIdentifierOrKeyword()</code></a> method. This method orchestrates a series of operations that manage the relationships between relevant classes during token scanning. The image below illustrates the call stack associated with these operations:</p>
<p><img src="../../assets/img/callstack.png" alt="img"></p>
<p>Before advancing to subsequent characters, the current character (<code>'f'</code>) must be preserved. The scanner utilizes a window structure for this purpose. Specifically, the <a href="https://v8-docs.vercel.app/literal-buffer_8h_source.html#l00088" target="_blank"><code>one_byte_char</code></a> variable holds the value of <code>c0_</code>, which is then stored in the <a href="https://v8-docs.vercel.app/literal-buffer_8h_source.html#l000100" target="_blank"><code>backing_store_</code></a>. We can verify this claim by checking the variable window in the vscode debug view with the current value of our <code>c0_</code> variable.</p>
<p><img src="../../assets/img/c0__value.png" alt="img"></p>
<p>Figure-1</p>
<p><img src="../../assets/img/one_byte_char_value.png" alt="img"></p>
<p>Figure-2</p>
<p>As we can see the value of <code>c0_</code> (102) in Figure-1 is the same as <code>one_byte_char</code> (102) in Figure-2 and 102 in ascii translates to <code>f</code>.
The <a href="https://v8-docs.vercel.app/scanner_8h_source.html#l00077" target="_blank"><code>AdvanceUntil()</code></a> method proceeds to iterate over each character sequentially, terminating upon encountering a designated terminator character. As depicted in Figure 3, this process results in the collection of the first eight characters, which form the string <code>&quot;function&quot;</code> in our example.</p>
<p>At this point, a complete token has been successfully accumulated. The subsequent step involves determining whether this token represents a reserved keyword or a general identifier. This classification is handled by the <a href="https://v8-docs.vercel.app/keywords-gen_8h_source.html#l00223" target="_blank"><code>GetToken()</code></a> method, which performs a straightforward lookup in a predefined hash table to retrieve the token type. Figure 4 provides an overview of the key members of <a href="https://v8-docs.vercel.app/keywords-gen_8h_source.html#l00093" target="_blank">this hash table</a>.</p>
<p>As a result of this process, the token corresponding to the string <code>&quot;function&quot;</code> is correctly identified and assigned the type <a href="https://v8-docs.vercel.app/keywords-gen_8h_source.html#l00106" target="_blank"><code>Token::kFunction</code></a>. Similarly, for the token <code>&quot;is_greater&quot;</code>, the system assigns the type <a href="https://v8-docs.vercel.app/token_8h_source.html#l00178" target="_blank"><code>Token::kIdentifier</code></a>, following the same mechanism.</p>
<p>Here is the control flow graph of the codeflow:</p>


<div class="mermaid">
graph TD
    A[Start: ScanSingleToken] -- c0_ is set to first character --> C{Is c0_ ASCII?}
    C -- Yes --> D[Check one_char_tokens]
    D --> E{IsAsciiIdentifier?}
    E -- Yes --> F[Token type: Token::kIdentifier]
    F --> G[Call ScanIdentifierOrKeyword]
    G --> H[Save current character in backing_store_]
    H --> I[Call AdvanceUntil - read until terminator]
    I --> J[Collect identifier string]
    J --> K[Token complete]
    K --> L[Call GetToken]
    L --> M[Lookup token in keyword hash table]
    M --> N{Is keyword?}
    N -- Yes --> O[Set Token type: appropriate keyword type]
    N -- No --> P[Set Token type: Token::kIdentifier with collected string]
    O --> Q[Advance to next token or End]
    P --> Q[Advance to next token or End]
    C -- No --> R[Handle non-ASCII case - not shown]
    E -- No --> S[Handle non-identifier case - not shown]

</div>


  
  <hr>
<div class="footer">
    
    
    
    <p>
    This is a post in the <b><a href="https://w1redch4d.github.io/series/understanding-v8-internals">Understanding V8 internals</a></b> series.
        <br>Other posts in this series:
        <ul class="series">
            
            
            
            <li>
                April 14, 2025 -
                
                    <a href="/post/parser-workflow/">Parser Workflow</a>
                
            </li>
            
            <li>
                April 13, 2025 -
                
                    Lexical Analysis
                
            </li>
            
            <li>
                April 12, 2025 -
                
                    <a href="/post/compiler-design-principles-in-v8/">Compiler Design Principles in V8</a>
                
            </li>
            
            <li>
                April 12, 2025 -
                
                    <a href="/post/compiler-design-1/">Compiler Design 1</a>
                
            </li>
            
            <li>
                April 11, 2025 -
                
                    <a href="/post/intro-v8/">Intro V8</a>
                
            </li>
            
        </ul>
    </p>
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#role-of-lexical-analysis">Role of Lexical Analysis</a></li>
    <li><a href="#tokens-lexemes-and-token-classes">Tokens, Lexemes, and Token Classes</a></li>
    <li><a href="#token-class">Token Class</a></li>
    <li><a href="#error-handling-in-lexical-analysis">Error Handling in Lexical Analysis</a></li>
    <li><a href="#software-implementation-of-lexical-analyzers">Software Implementation of Lexical Analyzers</a></li>
    <li><a href="#lexer-in-v8">Lexer in V8</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
